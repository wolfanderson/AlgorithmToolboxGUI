# 项目运行指南

## 📋 目录

1. [环境要求](#环境要求)
2. [快速开始](#快速开始)
3. [详细安装步骤](#详细安装步骤)
4. [运行项目](#运行项目)
5. [验证安装](#验证安装)
6. [常见问题](#常见问题)
7. [可选功能配置](#可选功能配置)

---

## 环境要求

### 必需环境
- **Python**: 3.7 或更高版本（推荐 3.8 - 3.11）
- **pip**: Python包管理器
- **操作系统**: Windows / Linux / macOS

### 推荐环境
- **Python 3.11**: 最佳兼容性（PaddleOCR支持良好）
- **虚拟环境**: 使用venv或conda隔离项目依赖

---

## 快速开始

### Windows用户

1. **双击运行安装脚本**（推荐）
   ```
   双击 install.bat
   ```

2. **启动项目**
   ```
   双击 run.bat
   ```

3. **打开浏览器**
   ```
   访问 http://localhost:5000
   ```

### Linux/Mac用户

1. **运行安装脚本**
   ```bash
   chmod +x install.sh
   ./install.sh
   ```

2. **启动项目**
   ```bash
   python app.py
   ```

3. **打开浏览器**
   ```
   访问 http://localhost:5000
   ```

---

## 详细安装步骤

### 方法一：使用虚拟环境（推荐）

#### Windows
```bash
# 1. 创建虚拟环境
python -m venv venv

# 2. 激活虚拟环境
venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 启动项目
python app.py
```

#### Linux/Mac
```bash
# 1. 创建虚拟环境
python3 -m venv venv

# 2. 激活虚拟环境
source venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 启动项目
python app.py
```

### 方法二：直接安装（不推荐）

```bash
# 直接安装到系统Python环境
pip install -r requirements.txt
python app.py
```

### 方法三：使用国内镜像源（网络较慢时）

```bash
# 使用清华镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或使用阿里云镜像
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

---

## 运行项目

### 方式一：直接运行（推荐）

```bash
python app.py
```

### 方式二：使用Flask命令

```bash
# 设置环境变量
export FLASK_APP=app.py  # Linux/Mac
set FLASK_APP=app.py     # Windows

# 运行
flask run
```

### 方式三：使用Python模块方式

```bash
python -m flask run
```

### 运行成功标志

看到以下输出表示启动成功：
```
 * Running on http://127.0.0.1:5000
 * Running on http://localhost:5000
```

---

## 验证安装

### 1. 检查Python版本
```bash
python --version
# 应该显示 Python 3.7 或更高版本
```

### 2. 检查依赖安装
```bash
python -c "import flask; import cv2; import numpy; print('所有依赖已安装')"
```

### 3. 访问Web界面
1. 打开浏览器
2. 访问 `http://localhost:5000`
3. 应该看到算法组合平台的界面

### 4. 测试功能
1. 点击"上传图片"按钮，上传一张测试图片
2. 从左侧拖拽一个算法到画布
3. 点击"执行工作流"按钮
4. 查看右侧的输出结果

---

## 常见问题

### ❌ 问题1: `ModuleNotFoundError: No module named 'flask'`

**原因**: 依赖未安装或虚拟环境未激活

**解决方法**:
```bash
# 激活虚拟环境
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 安装依赖
pip install -r requirements.txt
```

### ❌ 问题2: `Port 5000 is already in use`

**原因**: 端口5000已被占用

**解决方法**:
```bash
# 方法1: 关闭占用端口的程序
# Windows: 查找并结束占用5000端口的进程
netstat -ano | findstr :5000
taskkill /PID <进程ID> /F

# Linux/Mac: 
lsof -ti:5000 | xargs kill -9

# 方法2: 修改app.py中的端口号
# 在app.py最后添加:
if __name__ == '__main__':
    app.run(port=5001)  # 使用其他端口
```

### ❌ 问题3: `opencv-python` 安装失败

**原因**: 缺少编译工具或网络问题

**解决方法**:
```bash
# 使用预编译版本
pip install opencv-python-headless

# 或使用旧版本
pip install opencv-python==4.5.5.64
```

### ❌ 问题4: PaddleOCR相关错误

**原因**: PaddleOCR未安装或Python版本不兼容

**解决方法**:
```bash
# 检查Python版本（推荐3.11）
python --version

# 安装PaddleOCR（可选，如果不使用OCR功能可以跳过）
pip install paddlepaddle
pip install paddleocr
```

**注意**: OCR功能是可选的，如果不需要OCR识别，可以跳过PaddleOCR的安装。

### ❌ 问题5: 浏览器无法访问

**解决方法**:
1. 检查Flask是否正常启动
2. 检查防火墙设置
3. 尝试访问 `http://127.0.0.1:5000` 而不是 `localhost`
4. 检查是否有代理设置影响

### ❌ 问题6: 上传图片失败

**解决方法**:
1. 检查 `uploads/` 目录是否存在且有写权限
2. 检查文件大小是否超过16MB限制
3. 检查文件格式是否支持（png, jpg, jpeg, gif, bmp, tiff, webp）

---

## 可选功能配置

### 1. OCR识别功能（可选）

如果需要使用OCR识别功能：

#### 安装PaddleOCR（本地OCR）
```bash
# 安装PaddlePaddle
pip install paddlepaddle

# 安装PaddleOCR
pip install paddleocr
```

**注意**: 
- Python 3.14可能不被支持，建议使用Python 3.11或3.12
- 首次运行会下载模型文件（约几百MB）

#### 配置DeepSeekOCR（大模型OCR）

1. **获取API密钥**
   - 访问 [DeepSeek官网](https://www.deepseek.com/)
   - 注册并获取API密钥

2. **配置API密钥**
   ```bash
   # Windows
   set DEEPSEEK_API_KEY=your_api_key_here
   
   # Linux/Mac
   export DEEPSEEK_API_KEY=your_api_key_here
   ```

3. **在节点配置中选择**
   - 选择OCR节点
   - 在配置面板中选择"DeepSeekOCR"方案
   - 输入API密钥（如果未设置环境变量）

### 2. 修改端口号

编辑 `app.py` 文件，在最后添加：

```python
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, debug=True)
```

### 3. 启用调试模式

编辑 `app.py` 文件：

```python
if __name__ == '__main__':
    app.run(debug=True)  # 启用调试模式
```

**注意**: 生产环境不要启用debug模式

---

## 项目结构说明

```
AlgorithmToolboxGUI/
├── app.py                    # Flask后端主文件
├── algorithms/               # 算法模块目录
│   ├── __init__.py
│   ├── ocr_recognition.py   # OCR识别（支持多种方案）
│   ├── ocr_providers.py     # OCR提供者抽象层
│   ├── image_filter.py       # 图像滤波
│   ├── edge_detection.py    # 边缘检测
│   ├── roi_extraction.py    # ROI提取
│   ├── image_segmentation.py # 图像分割
│   └── image_registration.py # 图像配准
├── static/                   # 前端静态文件
│   ├── index.html           # 主页面
│   ├── style.css            # 样式文件
│   └── app.js               # 前端逻辑
├── uploads/                  # 上传文件存储目录（自动创建）
├── requirements.txt          # Python依赖列表
├── run.bat                   # Windows快速启动脚本
├── install.bat               # Windows安装脚本
├── install.sh                # Linux/Mac安装脚本
└── README.md                 # 项目说明
```

---

## 下一步

安装完成后，您可以：

1. **查看使用说明**: 阅读 `README.md` 了解基本功能
2. **查看架构文档**: 阅读 `架构设计文档.md` 了解系统架构
3. **配置OCR功能**: 阅读 `OCR使用说明.md` 配置OCR识别
4. **开始使用**: 上传图片，拖拽算法，执行工作流

---

## 获取帮助

如果遇到问题：

1. **查看日志**: 检查控制台输出的错误信息
2. **查看文档**: 
   - `安装说明.md` - 安装问题排查
   - `安装说明_PaddleOCR.md` - PaddleOCR安装问题
   - `OCR使用说明.md` - OCR功能使用
3. **检查环境**: 确认Python版本和依赖是否正确安装

---

**祝您使用愉快！** 🎉

